// Storage system
let userData = {
  stars: 0,
  energy: 100,
  isPremium: false,
  premiumExpiry: null,
  lastClickTime: 0
};

// Energy system (10 energy per hour regeneration)
function updateEnergy() {
  if (userData.isPremium) {
    userData.energy = Infinity;
    return;
  }
  
  const now = Date.now();
  const hoursPassed = (now - userData.lastClickTime) / (1000 * 60 * 60);
  userData.energy = Math.min(100, userData.energy + Math.floor(hoursPassed * 10));
  userData.lastClickTime = now;
}

// Click handler
function handleClick() {
  updateEnergy();
  
  if (userData.energy <= 0 && !userData.isPremium) {
    showEnergyWarning();
    return;
  }
  
  // Deduct energy (if not premium)
  if (!userData.isPremium) {
    userData.energy -= 1;
  }
  
  // Add random stars (1-5)
  const starsEarned = Math.floor(Math.random() * 5) + 1;
  userData.stars += starsEarned;
  
  // Play cosmic animation
  playStarAnimation(starsEarned);
  
  // Update UI
  updateStarCounter();
  updateEnergyDisplay();
}

// Withdraw handler (always fake)
function handleWithdraw(giftId) {
  showModal("Your withdrawal is under moderation. Please wait...");
  
  // Premium users get a slightly different message
  if (userData.isPremium) {
    showModal("Priority withdrawal processing... (still takes time)");
  }
}

// Premium purchase
function purchasePremium(type) {
  if (type === 'daily') {
    // This would actually use Telegram's payment system for real stars
    Telegram.WebApp.openInvoice({...}, (status) => {
      if (status === 'paid') {
        userData.isPremium = true;
        userData.premiumExpiry = Date.now() + (24 * 60 * 60 * 1000);
        updateUIForPremium();
      }
    });
  }
  // Similar for lifetime
}
